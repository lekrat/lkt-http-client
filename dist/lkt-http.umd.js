(function(n,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("axios"),require("lkt-control-tools"),require("lkt-string-tools"),require("lkt-object-tools")):typeof define=="function"&&define.amd?define(["exports","axios","lkt-control-tools","lkt-string-tools","lkt-object-tools"],m):(n=typeof globalThis<"u"?globalThis:n||self,m(n.LktHTTP={},n.axios,n.LktControlTools,n.LktStringTools,n.LktObjectTools))})(this,function(n,m,S,T,D){"use strict";const g=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(m);class H{constructor(e){e||(e=""),this.value=e}}class _{constructor(e){if(e==="")throw new Error("A resource must have a valid name");this.value=e}}class y{constructor(e,s,u){this.name=new _(e),this.url=new H(s),this.auth=u}}const c=class{static addResource(t){c.RESOURCES[t.name.value]=t}static addEnvironment(t){typeof c.DEFAULT_ENVIRONMENT>"u"&&(c.DEFAULT_ENVIRONMENT=t.name.value),c.ENVIRONMENTS[t.name.value]=t}static getEnvironment(t){if(c.ENVIRONMENTS[t]instanceof y)return c.ENVIRONMENTS[t]}};let a=c;a.RESOURCES={},a.ENVIRONMENTS={},a.DEFAULT_ENVIRONMENT=void 0,a.getResource=t=>{if(c.RESOURCES[t]instanceof w)return c.RESOURCES[t]},a.existsResource=t=>c.RESOURCES[t]instanceof w;const U=t=>{const e=[];return Object.keys(t).forEach(u=>{Array.isArray(t[u])?t[u].length>0&&e.push(`${u}=${JSON.stringify(t[u])}`):e.push(`${u}=${t[u]}`)}),e.join("&")},j=t=>a.existsResource(t);class L{constructor(e){e||(e="json"),this.value=e}isJSON(){return this.value==="json"}}class C{constructor(e){e||(e="default"),this.value=e}getUrl(){const e=v(this.value);return e?e.url.value:""}getAuth(){const e=v(this.value);return e&&e.auth?e.auth:{}}}class F{constructor(e){e||(e=!1),this.value=e}}class I{constructor(e=!1){this.value=e}inProgress(){return this.value}start(){this.value=!0}stop(){this.value=!1}}class M{constructor(e){e||(e="get"),this.value=e}toPrimitive(){return this.value.toLowerCase()}isGET(){return this.value==="get"}isPOST(){return this.value==="post"}isPUT(){return this.value==="put"}isDELETE(){return this.value==="delete"}isOPEN(){return this.value==="open"}isDOWNLOAD(){return this.value==="download"}hasUrlParams(){return this.isGET()||this.isOPEN()}}class E{}E.RESOURCE_PARAM_LEFT_SEPARATOR="{",E.RESOURCE_PARAM_RIGHT_SEPARATOR="}";class ${constructor(e){e||(e={}),this.value=e}prepareValues(e,s=!1){e||(e={});const u=Object.keys(this.value),r=s?new window.FormData:{};return u.forEach(o=>{const l=this.value[o].default||null;if(e[o]||l){const P=this.value[o].renameTo||null||o;let i=e[o]||l;const h=this.value[o].type||null;if(h&&i!==null&&typeof i!==void 0)if(h==="string"&&typeof i!="string")i=T.toString(i);else if(h==="number"&&typeof i!="number")i=Number(i);else{if(h==="boolean"&&typeof i!="boolean")throw new Error(`Param '${o}' must be of type boolean. '${i}' received`);if(h==="array"&&!Array.isArray(i))throw new Error(`Param '${o}' must be a valid array. '${i}' received`);if(h==="object"&&typeof i!="object")throw new Error(`Param '${o}' must be a valid object. '${i}' received`)}s?r.append(P,i):r[P]=i}}),r}replaceUrlValues(e,s){const u=this.prepareValues(s,!1);return T.fill(e,u,E.RESOURCE_PARAM_LEFT_SEPARATOR,E.RESOURCE_PARAM_RIGHT_SEPARATOR)}}class x{constructor(e){if(e==="")throw new Error("A resource must have a valid url");this.value=e}prepare(e){return e?`${e}${this.value}`:this.value}}class G{constructor(e){typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e){return this.value(e)}}class q{constructor(e){e||(e=!1),this.value=e}}class J{constructor(e){e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return D.fetchInObject(e,this.value)}}class k{constructor(e){e||(e=[200,201,202]),this.value=e}includes(e){return this.value.includes(e)}}class B{constructor(e,s,u,r,o,l){this.url=e,this.method=s,this.data=u,this.auth=r,this.statusValidator=o,this.headers=l}}class w{constructor(e){this.data=e,this.url=new x(e.url),this.name=new _(e.name),this.method=new M(e.method),this.environment=new C(e.environment),this.dataType=new L(e.dataType),this.params=new $(e.params),this.isFileUpload=new F(e.isFileUpload),this.validStatuses=new k(e.validStatuses),this.fetchStatus=new I,this.onSuccess=new G(e.onSuccess),this.returnsFullResponse=new q(e.returnsFullResponse),this.returnsResponseDig=new J(e.returnsResponseDig)}build(e){let s=this.params.prepareValues(e,this.isFileUpload.value);const u=this.url.prepare(this.environment.getUrl());let r=this.params.replaceUrlValues(u,e);if(this.method.hasUrlParams()){const R=U(s);R.length>0&&(r=[r,R].join("?")),s={}}const o=R=>this.validStatuses.includes(R);let l;return this.isFileUpload.value&&(l={"Content-Type":"multipart/form-data"}),new B(r,this.method.toPrimitive(),s,this.environment.getAuth(),o,l)}call(e){const s=this.build(e),u=(r,o)=>{r(void 0)};if(this.fetchStatus.inProgress())return S.emptyPromise(u);switch(s.method){case"get":case"post":case"put":case"delete":return this.fetchStatus.start(),g.default(s).then(r=>{this.fetchStatus.stop();let o=this.returnsFullResponse.value?r:r.data;return this.returnsResponseDig.hasToDig()&&(o=this.returnsResponseDig.dig(o)),this.onSuccess.hasActionDefined()?this.onSuccess.run(o):o}).catch(r=>(this.fetchStatus.stop(),Promise.reject(new Error(r))));case"download":case"open":return g.default.get(s.url,{responseType:"blob"}).then(r=>{const o=r.headers["content-disposition"];let l="";return o&&o.split(";").forEach(P=>{const i=P.split("=");if(T.trim(i[0])==="filename"){let h=T.trim(i[1]);h=T.trim(h,'"'),l=h}}),window.download(r.data,l),this.onSuccess.hasActionDefined()?this.onSuccess.run(r):r}).catch(r=>r);default:throw new Error(`Error: Invalid method in call ${JSON.stringify(s)}`)}}}var K=Object.defineProperty,W=Object.defineProperties,z=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable,N=(t,e,s)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,f=(t,e)=>{for(var s in e||(e={}))Q.call(e,s)&&N(t,s,e[s]);if(A)for(var s of A(e))X.call(e,s)&&N(t,s,e[s]);return t},d=(t,e)=>W(t,z(e));const Y=t=>{const e=d(f({},t),{method:"get"});return p(e)},Z=t=>{const e=d(f({},t),{method:"post"});return p(e)},ee=t=>{const e=d(f({},t),{method:"put"});return p(e)},te=t=>{const e=d(f({},t),{method:"delete"});return p(e)},se=t=>{const e=d(f({},t),{method:"open"});return p(e)},re=t=>{const e=d(f({},t),{method:"download"});return p(e)},p=t=>{const e=new w(t);return a.addResource(e),O(t.name)},b=t=>{const e=new y(t.name,t.url,t.auth);return a.addEnvironment(e),v(t.name)},O=t=>a.getResource(t),v=t=>a.getEnvironment(t),V=(t="",e={})=>O(t).call(e);class ne{constructor(e){e||(e=""),this.value=e}exists(){return a.existsResource(this.value)}call(e){return V(this.value,e)}}class oe{constructor(e){e||(e={}),this.value=e}getParams(){return this.value}}class ie{constructor(e){this.resource=new ne(e.resource),this.params=new oe(e.params)}isCallable(){return this.resource.exists()}call(){return this.isCallable()?this.resource.call(this.params.getParams()):S.emptyPromise()}}const ue={install:(t,e)=>{b({name:"default",url:""}),window.download=require("downloadjs")}};n.ResourceCaller=ie,n.createHTTPDeleteResource=te,n.createHTTPDownloadResource=re,n.createHTTPEnvironment=b,n.createHTTPGetResource=Y,n.createHTTPOpenResource=se,n.createHTTPPostResource=Z,n.createHTTPPutResource=ee,n.default=ue,n.existsHTTPResource=j,n.getHTTPEnvironment=v,n.getHTTPResource=O,n.httpCall=V,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
