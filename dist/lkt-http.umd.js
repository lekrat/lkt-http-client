(function(r,T){typeof exports=="object"&&typeof module<"u"?T(exports,require("axios"),require("lkt-control-tools"),require("lkt-object-tools"),require("lkt-string-tools")):typeof define=="function"&&define.amd?define(["exports","axios","lkt-control-tools","lkt-object-tools","lkt-string-tools"],T):(r=typeof globalThis<"u"?globalThis:r||self,T(r.LktHTTP={},r.axios,r.lktControlTools,r.lktObjectTools,r.lktStringTools))})(this,function(r,T,H,U,p){"use strict";const S=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(T);class D{constructor(e){e||(e=""),this.value=e}}class w{constructor(e){if(e==="")throw new Error("A resource must have a valid name");this.value=e}}class _{constructor(e,s,o){this.name=new w(e),this.url=new D(s),this.auth=o}}const u=class{static addResource(t){u.RESOURCES[t.name.value]=t}static addEnvironment(t){typeof u.DEFAULT_ENVIRONMENT>"u"&&(u.DEFAULT_ENVIRONMENT=t.name.value),u.ENVIRONMENTS[t.name.value]=t}static getEnvironment(t){if(u.ENVIRONMENTS[t]instanceof _)return u.ENVIRONMENTS[t]}};let c=u;c.RESOURCES={},c.ENVIRONMENTS={},c.DEFAULT_ENVIRONMENT=void 0,c.getResource=t=>{if(u.RESOURCES[t]instanceof m)return u.RESOURCES[t]},c.existsResource=t=>u.RESOURCES[t]instanceof m;const V=t=>{const e=[];return Object.keys(t).forEach(o=>{Array.isArray(t[o])?t[o].length>0&&e.push(`${o}=${JSON.stringify(t[o])}`):e.push(`${o}=${t[o]}`)}),e.join("&")},j=t=>c.existsResource(t);class a{}a.RESOURCE_PARAM_LEFT_SEPARATOR="{",a.RESOURCE_PARAM_RIGHT_SEPARATOR="}";class b{constructor(e){e||(e="json"),this.value=e}isJSON(){return this.value==="json"}}class L{constructor(e){e||(e="default"),this.value=e}getUrl(){const e=E(this.value);return e?e.url.value:""}getAuth(){const e=E(this.value);return e&&e.auth?e.auth:{}}}class C{constructor(e){e||(e=!1),this.value=e}}class M{constructor(e=!1){this.value=e}inProgress(){return this.value}start(){this.value=!0}stop(){this.value=!1}}class I{constructor(e){e||(e="get"),this.value=e}toPrimitive(){return this.value.toLowerCase()}isGET(){return this.value==="get"}isPOST(){return this.value==="post"}isPUT(){return this.value==="put"}isDELETE(){return this.value==="delete"}isOPEN(){return this.value==="open"}isDOWNLOAD(){return this.value==="download"}hasUrlParams(){return this.isGET()||this.isOPEN()}}class F{constructor(e){e||(e={}),this.value=e}getDefaultValues(){Object.keys(this.value).forEach(s=>{this.value[s].default&&this.value[s].default})}prepareValues(e,s=!1){e||(e={});const o=Object.keys(this.value),n=s?new window.FormData:{};return o.forEach(i=>{e[i]&&(s?n.append(i,e[i]):n[i]=e[i])}),n}}class k{constructor(e){if(e==="")throw new Error("A resource must have a valid url");this.value=e}prepare(e){return e?`${e}${this.value}`:this.value}}class x{constructor(e){typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e){return this.value(e)}}class G{constructor(e){e||(e=[200,201,202]),this.value=e}includes(e){return this.value.includes(e)}}class ${constructor(e,s,o,n,i,f){this.url=e,this.method=s,this.data=o,this.auth=n,this.statusValidator=i,this.headers=f}}class m{constructor(e){this.data=e,this.url=new k(e.url),this.name=new w(e.name),this.method=new I(e.method),this.environment=new L(e.environment),this.dataType=new b(e.dataType),this.params=new F(e.params),this.isFileUpload=new C(e.isFileUpload),this.validStatuses=new G(e.validStatuses),this.fetchStatus=new M,this.onSuccess=new x(e.onSuccess)}build(e){let s=this.params.prepareValues(e,this.isFileUpload.value);const o=this.url.prepare(this.environment.getUrl()),n=p.extractFillData(o,s,a.RESOURCE_PARAM_LEFT_SEPARATOR,a.RESOURCE_PARAM_RIGHT_SEPARATOR);let i=p.fill(o,s,a.RESOURCE_PARAM_LEFT_SEPARATOR,a.RESOURCE_PARAM_RIGHT_SEPARATOR);if(s=U.deleteObjectProperties(s,n),this.method.hasUrlParams()){const R=V(s);R.length>0&&(i=[i,R].join("?")),s={}}const f=R=>this.validStatuses.includes(R);let v;return this.isFileUpload.value&&(v={"Content-Type":"multipart/form-data"}),new $(i,this.method.toPrimitive(),s,this.environment.getAuth(),f,v)}call(e){const s=this.build(e),o=(n,i)=>{n(void 0)};if(this.fetchStatus.inProgress())return H.emptyPromise(o);switch(s.method){case"get":case"post":case"put":case"delete":return this.fetchStatus.start(),S.default(s).then(n=>(this.fetchStatus.stop(),this.onSuccess.hasActionDefined()?this.onSuccess.run(n):n)).catch(n=>(this.fetchStatus.stop(),Promise.reject(new Error(n))));case"download":case"open":return S.default.get(s.url,{responseType:"blob"}).then(n=>{const i=n.headers["content-disposition"];let f="";return i&&i.split(";").forEach(R=>{const y=R.split("=");if(p.trim(y[0])==="filename"){let O=p.trim(y[1]);O=p.trim(O,'"'),f=O}}),window.download(n.data,f),this.onSuccess.hasActionDefined()?this.onSuccess.run(n):n}).catch(n=>n);default:throw new Error(`Error: Invalid method in call ${JSON.stringify(s)}`)}}}var q=Object.defineProperty,J=Object.defineProperties,B=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,g=(t,e,s)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,l=(t,e)=>{for(var s in e||(e={}))W.call(e,s)&&g(t,s,e[s]);if(A)for(var s of A(e))K.call(e,s)&&g(t,s,e[s]);return t},h=(t,e)=>J(t,B(e));const Q=t=>{const e=h(l({},t),{method:"get"});return d(e)},X=t=>{const e=h(l({},t),{method:"post"});return d(e)},Y=t=>{const e=h(l({},t),{method:"put"});return d(e)},Z=t=>{const e=h(l({},t),{method:"delete"});return d(e)},z=t=>{const e=h(l({},t),{method:"open"});return d(e)},ee=t=>{const e=h(l({},t),{method:"download"});return d(e)},d=t=>{const e=new m(t);return c.addResource(e),P(t.name)},N=t=>{const e=new _(t.name,t.url,t.auth);return c.addEnvironment(e),E(t.name)},P=t=>c.getResource(t),E=t=>c.getEnvironment(t),te=(t="",e={})=>P(t).call(e),se={install:(t,e)=>{N({name:"default",url:""}),window.download=require("downloadjs")}};r.createHTTPDeleteResource=Z,r.createHTTPDownloadResource=ee,r.createHTTPEnvironment=N,r.createHTTPGetResource=Q,r.createHTTPOpenResource=z,r.createHTTPPostResource=X,r.createHTTPPutResource=Y,r.default=se,r.existsHTTPResource=j,r.getHTTPEnvironment=E,r.getHTTPResource=P,r.httpCall=te,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
