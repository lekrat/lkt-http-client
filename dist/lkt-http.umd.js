(function(r,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("axios"),require("lkt-control-tools"),require("lkt-string-tools"),require("lkt-object-tools")):typeof define=="function"&&define.amd?define(["exports","axios","lkt-control-tools","lkt-string-tools","lkt-object-tools"],c):(r=typeof globalThis<"u"?globalThis:r||self,c(r.LktHTTP={},r.axios,r.LktControlTools,r.LktStringTools,r.LktObjectTools))})(this,function(r,c,d,T,D){"use strict";var ee=Object.defineProperty;var te=(r,c,d)=>c in r?ee(r,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):r[c]=d;var s=(r,c,d)=>(te(r,typeof c!="symbol"?c+"":c,d),d);const g=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(c);class U{constructor(e){s(this,"value");e||(e=""),this.value=e}}class O{constructor(e){s(this,"value");if(e==="")throw new Error("A resource must have a valid name");this.value=e}}class A{constructor(e,o,n){s(this,"name");s(this,"url");s(this,"auth");this.name=new O(e),this.url=new U(o),this.auth=n}}const h=class{static addResource(e){h.RESOURCES[e.name.value]=e}static addEnvironment(e){typeof h.DEFAULT_ENVIRONMENT>"u"&&(h.DEFAULT_ENVIRONMENT=e.name.value),h.ENVIRONMENTS[e.name.value]=e}static getEnvironment(e){if(h.ENVIRONMENTS[e]instanceof A)return h.ENVIRONMENTS[e]}};let l=h;s(l,"RESOURCES",{}),s(l,"ENVIRONMENTS",{}),s(l,"DEFAULT_ENVIRONMENT"),s(l,"getResource",e=>{if(h.RESOURCES[e]instanceof w)return h.RESOURCES[e]}),s(l,"existsResource",e=>h.RESOURCES[e]instanceof w);const y=t=>{const e=[];return Object.keys(t).forEach(n=>{Array.isArray(t[n])?t[n].length>0&&e.push(`${n}=${JSON.stringify(t[n])}`):e.push(`${n}=${t[n]}`)}),e.join("&")},H=t=>l.existsResource(t);class b{constructor(e){s(this,"value");e||(e="json"),this.value=e}isJSON(){return this.value==="json"}}class j{constructor(e){s(this,"value");e||(e="default"),this.value=e}getUrl(){const e=P(this.value);return e?e.url.value:""}getAuth(){const e=P(this.value);return e&&e.auth?e.auth:{}}}class C{constructor(e){s(this,"value");e||(e=!1),this.value=e}}class F{constructor(e=!1){s(this,"value");this.value=e}inProgress(){return this.value}start(){this.value=!0}stop(){this.value=!1}}class M{constructor(e){s(this,"value");e||(e="get"),this.value=e}toPrimitive(){return this.value.toLowerCase()}isGET(){return this.value==="get"}isPOST(){return this.value==="post"}isPUT(){return this.value==="put"}isDELETE(){return this.value==="delete"}isOPEN(){return this.value==="open"}isDOWNLOAD(){return this.value==="download"}hasUrlParams(){return this.isGET()||this.isOPEN()}}class E{}s(E,"RESOURCE_PARAM_LEFT_SEPARATOR","{"),s(E,"RESOURCE_PARAM_RIGHT_SEPARATOR","}");class ${constructor(e){s(this,"value");e||(e={}),this.value=e}prepareValues(e,o=!1){e||(e={});const n=Object.keys(this.value),u=o?new window.FormData:{};return n.forEach(a=>{const f=this.value[a].default||null;if(e[a]||f){const v=this.value[a].renameTo||null||a;let i=e[a]||f;const p=this.value[a].type||null;if(p&&i!==null&&typeof i!==void 0)if(p==="string"&&typeof i!="string")i=T.toString(i);else if(p==="number"&&typeof i!="number")i=Number(i);else{if(p==="boolean"&&typeof i!="boolean")throw new Error(`Param '${a}' must be of type boolean. '${i}' received`);if(p==="array"&&!Array.isArray(i))throw new Error(`Param '${a}' must be a valid array. '${i}' received`);if(p==="object"&&typeof i!="object")throw new Error(`Param '${a}' must be a valid object. '${i}' received`)}o?u.append(v,i):u[v]=i}}),u}replaceUrlValues(e,o){const n=this.prepareValues(o,!1);return T.fill(e,n,E.RESOURCE_PARAM_LEFT_SEPARATOR,E.RESOURCE_PARAM_RIGHT_SEPARATOR)}}class I{constructor(e){s(this,"value");if(e==="")throw new Error("A resource must have a valid url");this.value=e}prepare(e){return e?`${e}${this.value}`:this.value}}class _{constructor(e){s(this,"value");typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e){return this.value(e)}}class L{constructor(e){s(this,"value");e||(e=!1),this.value=e}}class x{constructor(e){s(this,"value");e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return D.fetchInObject(e,this.value)}}class G{constructor(e){s(this,"value");e||(e=[200,201,202]),this.value=e}includes(e){return this.value.includes(e)}}class q{constructor(e,o,n,u,a,f){s(this,"url");s(this,"method");s(this,"data");s(this,"auth");s(this,"statusValidator");s(this,"headers");this.url=e,this.method=o,this.data=n,this.auth=u,this.statusValidator=a,this.headers=f}}class w{constructor(e){s(this,"data");s(this,"url");s(this,"name");s(this,"method");s(this,"environment");s(this,"dataType");s(this,"params");s(this,"isFileUpload");s(this,"validStatuses");s(this,"fetchStatus");s(this,"onSuccess");s(this,"returnsFullResponse");s(this,"returnsResponseDig");this.data=e,this.url=new I(e.url),this.name=new O(e.name),this.method=new M(e.method),this.environment=new j(e.environment),this.dataType=new b(e.dataType),this.params=new $(e.params),this.isFileUpload=new C(e.isFileUpload),this.validStatuses=new G(e.validStatuses),this.fetchStatus=new F,this.onSuccess=new _(e.onSuccess),this.returnsFullResponse=new L(e.returnsFullResponse),this.returnsResponseDig=new x(e.returnsResponseDig)}build(e){let o=this.params.prepareValues(e,this.isFileUpload.value);const n=this.url.prepare(this.environment.getUrl());let u=this.params.replaceUrlValues(n,e);if(this.method.hasUrlParams()){const m=y(o);m.length>0&&(u=[u,m].join("?")),o={}}const a=m=>this.validStatuses.includes(m);let f;return this.isFileUpload.value&&(f={"Content-Type":"multipart/form-data"}),new q(u,this.method.toPrimitive(),o,this.environment.getAuth(),a,f)}call(e){const o=this.build(e);if(this.fetchStatus.inProgress())return d.successPromise();switch(o.method){case"get":case"post":case"put":case"delete":return this.fetchStatus.start(),g.default(o).then(n=>{this.fetchStatus.stop();let u=this.returnsFullResponse.value?n:n.data;return this.returnsResponseDig.hasToDig()&&(u=this.returnsResponseDig.dig(u)),this.onSuccess.hasActionDefined()?this.onSuccess.run(u):u}).catch(n=>(this.fetchStatus.stop(),Promise.reject(new Error(n))));case"download":case"open":return g.default.get(o.url,{responseType:"blob"}).then(n=>{const u=n.headers["content-disposition"];let a="";return u&&u.split(";").forEach(m=>{const v=m.split("=");if(T.trim(v[0])==="filename"){let i=T.trim(v[1]);i=T.trim(i,'"'),a=i}}),window.download(n.data,a),this.onSuccess.hasActionDefined()?this.onSuccess.run(n):n}).catch(n=>n);default:throw new Error(`Error: Invalid method in call ${JSON.stringify(o)}`)}}}const J=t=>{const e={...t,method:"get"};return R(e)},B=t=>{const e={...t,method:"post"};return R(e)},K=t=>{const e={...t,method:"put"};return R(e)},W=t=>{const e={...t,method:"delete"};return R(e)},z=t=>{const e={...t,method:"open"};return R(e)},Q=t=>{const e={...t,method:"download"};return R(e)},R=t=>{const e=new w(t);return l.addResource(e),S(t.name)},N=t=>{const e=new A(t.name,t.url,t.auth);return l.addEnvironment(e),P(t.name)},S=t=>l.getResource(t),P=t=>l.getEnvironment(t),V=(t="",e={})=>S(t).call(e);class X{constructor(e){s(this,"value");e||(e=""),this.value=e}exists(){return l.existsResource(this.value)}call(e){return V(this.value,e)}}class Y{constructor(e){s(this,"value");e||(e={}),this.value=e}getParams(){return this.value}}class Z{constructor(e){s(this,"resource");s(this,"params");this.resource=new X(e.resource),this.params=new Y(e.params)}isCallable(){return this.resource.exists()}call(){return this.isCallable()?this.resource.call(this.params.getParams()):d.emptyPromise()}}const k={install:(t,e)=>{N({name:"default",url:""}),window.download=require("downloadjs")}};r.ResourceCaller=Z,r.createHTTPDeleteResource=W,r.createHTTPDownloadResource=Q,r.createHTTPEnvironment=N,r.createHTTPGetResource=J,r.createHTTPOpenResource=z,r.createHTTPPostResource=B,r.createHTTPPutResource=K,r.default=k,r.existsHTTPResource=H,r.getHTTPEnvironment=P,r.getHTTPResource=S,r.httpCall=V,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
