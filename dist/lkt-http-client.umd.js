(function(r,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("axios"),require("lkt-control-tools"),require("lkt-string-tools"),require("lkt-object-tools")):typeof define=="function"&&define.amd?define(["exports","axios","lkt-control-tools","lkt-string-tools","lkt-object-tools"],l):(r=typeof globalThis<"u"?globalThis:r||self,l(r.LktHttpClient={},r.axios,r.LktControlTools,r.LktStringTools,r.LktObjectTools))})(this,function(r,l,c,P,A){"use strict";var re=Object.defineProperty;var ne=(r,l,c)=>l in r?re(r,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[l]=c;var s=(r,l,c)=>(ne(r,typeof l!="symbol"?l+"":l,c),c);const S=(t=>t&&typeof t=="object"&&"default"in t?t:{default:t})(l);class O{constructor(e){s(this,"value");e||(e=""),this.value=e}}class y{constructor(e){s(this,"value");if(e==="")throw new Error("A resource must have a valid name");this.value=e}}class w{constructor(e,a,n){s(this,"name");s(this,"url");s(this,"auth");this.name=new y(e),this.url=new O(a),this.auth=n}}class V{constructor(){s(this,"value",{})}add(e){this.value[e.name.value]=e}get(e){if(this.value[e]instanceof w)return this.value[e]}exists(e){return this.value[e]instanceof w}}class x{constructor(){s(this,"value",{})}add(e){this.value[e.name.value]=e}get(e){if(this.value[e]instanceof E)return this.value[e]}exists(e){return this.value[e]instanceof E}}class d{constructor(){s(this,"resources");s(this,"environments");this.resources=new x,this.environments=new V}}s(d,"router"),s(d,"DEFAULT_ENVIRONMENT");const U=t=>{const e=[];return Object.keys(t).forEach(n=>{Array.isArray(t[n])?t[n].length>0&&e.push(`${n}=${JSON.stringify(t[n])}`):e.push(`${n}=${t[n]}`)}),e.join("&")},j=t=>f().resources.exists(t),f=()=>(d.router instanceof d||(d.router=new d),d.router);class _{constructor(e){s(this,"value");e||(e="json"),this.value=e}isJSON(){return this.value==="json"}}class M{constructor(e){s(this,"value");e||(e="default"),this.value=e}getUrl(){const e=g(this.value);return e?e.url.value:""}getAuth(){const e=g(this.value);return e&&e.auth?e.auth:{}}}class C{constructor(e){s(this,"value");e||(e=!1),this.value=e}}class F{constructor(e){s(this,"value");e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return A.fetchInObject(e,this.value)}}class L{constructor(e=!1){s(this,"value");this.value=e}inProgress(){return this.value}start(){this.value=!0}stop(){this.value=!1}}class ${constructor(e){s(this,"value");e||(e="get"),this.value=e}toPrimitive(){return this.value.toLowerCase()}isGET(){return this.value==="get"}isPOST(){return this.value==="post"}isPUT(){return this.value==="put"}isDELETE(){return this.value==="delete"}isOPEN(){return this.value==="open"}isDOWNLOAD(){return this.value==="download"}hasUrlParams(){return this.isGET()||this.isOPEN()}}class R{}s(R,"RESOURCE_PARAM_LEFT_SEPARATOR","{"),s(R,"RESOURCE_PARAM_RIGHT_SEPARATOR","}");class N{constructor(e){s(this,"value");e||(e={}),this.value=e}prepareValues(e,a=!1){e||(e={});const n=Object.keys(this.value),o=a?new window.FormData:{};return n.forEach(u=>{const h=this.value[u].default||null;if(e[u]||h){const T=this.value[u].renameTo||null||u;let i=e[u]||h;const p=this.value[u].type||null;if(p&&i!==null&&typeof i!==void 0)if(p==="string"&&typeof i!="string")i=P.toString(i);else if(p==="number"&&typeof i!="number")i=Number(i);else{if(p==="boolean"&&typeof i!="boolean")throw new Error(`Param '${u}' must be of type boolean. '${i}' received`);if(p==="array"&&!Array.isArray(i))throw new Error(`Param '${u}' must be a valid array. '${i}' received`);if(p==="object"&&typeof i!="object")throw new Error(`Param '${u}' must be a valid object. '${i}' received`)}a?o.append(T,i):o[T]=i}}),o}replaceUrlValues(e,a){const n=this.prepareValues(a,!1);return P.fill(e,n,R.RESOURCE_PARAM_LEFT_SEPARATOR,R.RESOURCE_PARAM_RIGHT_SEPARATOR)}}class I{constructor(e){s(this,"value");if(e==="")throw new Error("A resource must have a valid url");this.value=e}prepare(e){return e?`${e}${this.value}`:this.value}}class G{constructor(e){s(this,"value");typeof e!="function"&&(e=void 0),this.value=e}hasActionDefined(){return typeof this.value=="function"}run(e){return this.value(e)}}class q{constructor(e){s(this,"value");e||(e=!1),this.value=e}}class J{constructor(e){s(this,"value");e||(e=""),this.value=e}hasToDig(){return this.value!==""}dig(e){return A.fetchInObject(e,this.value)}}class B{constructor(e){s(this,"value");e||(e=[200,201,202]),this.value=e}includes(e){return this.value.includes(e)}}class K{constructor(e,a,n,o,u,h){s(this,"url");s(this,"method");s(this,"data");s(this,"auth");s(this,"statusValidator");s(this,"headers");this.url=e,this.method=a,this.data=n,this.auth=o,this.statusValidator=u,this.headers=h}}class E{constructor(e){s(this,"data");s(this,"url");s(this,"name");s(this,"method");s(this,"environment");s(this,"dataType");s(this,"params");s(this,"isFileUpload");s(this,"validStatuses");s(this,"fetchStatus");s(this,"onSuccess");s(this,"returnsFullResponse");s(this,"returnsResponseDig");s(this,"maxPageDig");s(this,"latestMaxPage",-1);this.data=e,this.url=new I(e.url),this.name=new y(e.name),this.method=new $(e.method),this.environment=new M(e.environment),this.dataType=new _(e.dataType),this.params=new N(e.params),this.isFileUpload=new C(e.isFileUpload),this.validStatuses=new B(e.validStatuses),this.fetchStatus=new L,this.onSuccess=new G(e.onSuccess),this.returnsFullResponse=new q(e.returnsFullResponse),this.returnsResponseDig=new J(e.returnsResponseDig),this.maxPageDig=new F(e.maxPageDig),this.latestMaxPage=-1}getLatestMaxPage(){return this.latestMaxPage}build(e){let a=this.params.prepareValues(e,this.isFileUpload.value);const n=this.url.prepare(this.environment.getUrl());let o=this.params.replaceUrlValues(n,e);if(this.method.hasUrlParams()){const m=U(a);m.length>0&&(o=[o,m].join("?")),a={}}const u=m=>this.validStatuses.includes(m);let h;return this.isFileUpload.value&&(h={"Content-Type":"multipart/form-data"}),new K(o,this.method.toPrimitive(),a,this.environment.getAuth(),u,h)}async call(e){const a=this.build(e);if(this.fetchStatus.inProgress())return c.successPromise();switch(a.method){case"get":case"post":case"put":case"delete":return this.fetchStatus.start(),await S.default(a).then(n=>{this.fetchStatus.stop();let o=this.returnsFullResponse.value?n:n.data;return this.maxPageDig.hasToDig()?this.latestMaxPage=this.maxPageDig.dig(o):this.latestMaxPage=-1,this.returnsResponseDig.hasToDig()&&(o=this.returnsResponseDig.dig(o)),this.onSuccess.hasActionDefined()?this.onSuccess.run(o):o}).catch(n=>(this.fetchStatus.stop(),Promise.reject(new Error(n))));case"download":case"open":return S.default.get(a.url,{responseType:"blob"}).then(n=>{const o=n.headers["content-disposition"];let u="";return o&&o.split(";").forEach(m=>{const T=m.split("=");if(P.trim(T[0])==="filename"){let i=P.trim(T[1]);i=P.trim(i,'"'),u=i}}),window.download(n.data,u),this.onSuccess.hasActionDefined()?this.onSuccess.run(n):n}).catch(n=>n);default:throw new Error(`Error: Invalid method in call ${JSON.stringify(a)}`)}}}const W=t=>{const e={...t,method:"get"};return v(e)},k=t=>{const e={...t,method:"post"};return v(e)},z=t=>{const e={...t,method:"put"};return v(e)},Q=t=>{const e={...t,method:"delete"};return v(e)},X=t=>{const e={...t,method:"open"};return v(e)},Y=t=>{const e={...t,method:"download"};return v(e)},v=t=>{const e=new E(t);return f().resources.add(e),D(t.name)},b=t=>{const e=new w(t.name,t.url,t.auth);return f().environments.add(e),g(t.name)},D=t=>f().resources.get(t),g=t=>f().environments.get(t),H=async(t="",e={})=>await D(t).call(e);class Z{constructor(e){s(this,"value");e||(e=""),this.value=e}exists(){return f().resources.exists(this.value)}async call(e){return await H(this.value,e)}}class ee{constructor(e){s(this,"value");e||(e={}),this.value=e}setParam(e,a){this.value[e]=a}getParams(){return this.value}}class te{constructor(e){s(this,"resource");s(this,"params");this.resource=new Z(e.resource),this.params=new ee(e.params)}isCallable(){return this.resource.exists()}setParam(e,a){this.params.setParam(e,a)}setParams(e){Object.keys(e).forEach(a=>{this.params.setParam(a,e[a])})}async call(){return this.isCallable()?await this.resource.call(this.params.getParams()):await c.successPromise()}}const se={install:(t,e)=>{b({name:"default",url:""}),window.download=require("downloadjs")}};r.ResourceCaller=te,r.createHTTPDeleteResource=Q,r.createHTTPDownloadResource=Y,r.createHTTPEnvironment=b,r.createHTTPGetResource=W,r.createHTTPOpenResource=X,r.createHTTPPostResource=k,r.createHTTPPutResource=z,r.default=se,r.existsHTTPResource=j,r.getHTTPEnvironment=g,r.getHTTPResource=D,r.getRouter=f,r.httpCall=H,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
